<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Assinatura Plus+</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Identity Services -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
    body {
        background:#0d0d0d;
        font-family: Arial, sans-serif;
        color:white;
        margin:0;
        padding:20px;
        text-align:center;
    }

    .card {
        background:#111;
        padding:20px;
        border-radius:14px;
        max-width:420px;
        margin:40px auto;
        box-shadow:0 0 14px rgba(255,0,80,0.2);
    }

    .plan-btn {
        width:100%;
        padding:14px;
        font-size:16px;
        border-radius:10px;
        margin-top:14px;
        border:none;
        cursor:pointer;
    }

    .disabled {
        opacity:0.4;
        pointer-events:none;
    }

    #gbutton {
        margin:20px auto;
        width:100%;
        display:flex;
        justify-content:center;
    }

    #logoutBtn {
        background:#333;
        color:white;
        padding:10px 14px;
        border-radius:8px;
        border:none;
        margin-top:20px;
    }

</style>

</head>
<body>

<div class="card">

    <img src="https://i.postimg.cc/fbm60y7Q/logo.png" 
         style="width:100%;border-radius:10px;margin-bottom:15px;">

    <h2>Assinar Plus+</h2>
    <p>Faça login com sua conta Google usada no app.</p>

    <!-- Botão que o Google irá renderizar -->
    <div id="gbutton"></div>

    <!-- Área de status -->
    <div id="statusArea" style="margin-top:10px;opacity:0.8;">
        Você não está logado.
    </div>

    <!-- Botões de planos -->
    <button id="btnMensal" class="plan-btn disabled" style="background:#ff0055;color:white;">
        Assinar Mensal (R$ 29,90)
    </button>

    <button id="btnAnual" class="plan-btn disabled" style="background:#ff3380;color:white;">
        Assinar Anual (R$ 199,90)
    </button>

    <!-- Botão de sair -->
    <button id="logoutBtn" style="display:none;">Sair da Conta</button>
</div>


<script>
// ==============================
//  CONFIG — Mesmo CLIENT_ID do app
// ==============================
const CLIENT_ID = "467099082704-bbqe4ble2u63mbpgv0mkdars78pigi6i.apps.googleusercontent.com";

// Links de pagamento
const LINK_PAGAMENTO_MENSAL = "https://mpago.la/2SRyqam";
const LINK_PAGAMENTO_ANUAL  = "https://mpago.la/2SRyqam";

// ELEMENTOS DO SITE
const btnMensal = document.getElementById("btnMensal");
const btnAnual  = document.getElementById("btnAnual");
const btnLogout = document.getElementById("logoutBtn");
const statusArea = document.getElementById("statusArea");

// Onde o Google vai renderizar o botão
const gbutton = document.getElementById("gbutton");


// ==============================
//  FUNÇÃO PADRÃO DO APP – parse JWT
// ==============================
function parseJwt(token) {
    try { return JSON.parse(atob(token.split('.')[1])); }
    catch(e) { return null; }
}


// ==============================
//  APLICA ESTADO DO LOGIN (igual app)
// ==============================
function applyLoginState() {
    const saved = localStorage.getItem("glplus_user");

    if (saved) {
        const user = JSON.parse(saved);

        statusArea.textContent = "Logado como " + user.email;

        btnLogout.style.display = "block";
        btnMensal.classList.remove("disabled");
        btnMensal.disabled = false;
        btnAnual.classList.remove("disabled");
        btnAnual.disabled = false;

    } else {
        statusArea.textContent = "Você não está logado.";

        btnLogout.style.display = "none";
        btnMensal.classList.add("disabled");
        btnMensal.disabled = true;
        btnAnual.classList.add("disabled");
        btnAnual.disabled = true;
    }
}


// ==============================
//  CALLBACK DO GOOGLE LOGIN
//  (EXATAMENTE O MESMO FORMATO DO APP)
// ==============================
function handleCredentialResponse(response) {
    const profile = parseJwt(response.credential);

    if (!profile) {
        alert("Erro ao autenticar Google.");
        return;
    }

    const user = {
        name: profile.name,
        email: profile.email,
        picture: profile.picture
    };

    // >>> MESMO STORAGE DO APP <<<
    localStorage.setItem("glplus_user", JSON.stringify(user));

    applyLoginState();
}


// ==============================
//  INICIALIZA O GOOGLE BUTTON
// ==============================
function initGoogle() {
    google.accounts.id.initialize({
        client_id: CLIENT_ID,
        callback: handleCredentialResponse
    });

    google.accounts.id.renderButton(gbutton, {
        theme: "outline",
        size: "large",
        text: "signin_with",
        width: 250
    });
}


// ==============================
//  EVENTOS DE CLICK
// ==============================
btnMensal.onclick = () => {
    window.open(LINK_PAGAMENTO_MENSAL, "_blank");
};

btnAnual.onclick = () => {
    window.open(LINK_PAGAMENTO_ANUAL, "_blank");
};

btnLogout.onclick = () => {
    localStorage.removeItem("glplus_user");
    applyLoginState();
};


// ==============================
//  START
// ==============================
window.onload = () => {
    applyLoginState();

    let tries = 0;
    const timer = setInterval(() => {
        if (window.google && google.accounts && google.accounts.id) {
            clearInterval(timer);
            initGoogle();
        }
        if (++tries > 20) clearInterval(timer);
    }, 200);
};
</script>

</body>
</html>
